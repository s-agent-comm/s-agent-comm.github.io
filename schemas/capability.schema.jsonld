{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://slashlife.ai/schema/capability.schema.jsonld",
  "title": "Agent Capability Schema",
  "description": "Semantic description of an agent-exposed capability, including function signature, constraints, and required execution context.",
  "type": "object",
  "@context": "https://slashlife.ai/contexts/capability.context.jsonld",

  "properties": {
    "id": {
      "type": "string",
      "description": "Unique identifier for the capability, stable across versions."
    },

    "type": {
      "type": "string",
      "enum": ["core:Capability", "cap:PrimitiveCapability", "cap:CompositeCapability"]
    },

    "label": {
      "type": "string",
      "description": "Human-readable name of the capability."
    },

    "description": {
      "type": "string",
      "description": "Functional description of what the capability does."
    },

    "dependsOnCapability": {
        "type": "array",
        "items": { "type": "string" },
        "description": "Declares capability-level dependencies."
    },

    "classifiedAs": {
        "type": "string",
        "description": "Categorizes the capability."
    },

    "provenance": {
        "type": "object",
        "properties": {
            "sourceSpec": { "type": "string", "format": "uri" },
            "capabilityVersion": { "type": "string" }
        }
    },

    "inputs": {
      "type": "array",
      "description": "Formal input parameters the capability accepts.",
      "items": {
        "type": "object",
        "properties": {
          "name": { "type": "string" },
          "datatype": { "type": "string" },
          "description": { "type": "string" },
          "required": { "type": "boolean", "default": false }
        },
        "required": ["name", "datatype"]
      }
    },

    "outputs": {
      "type": "array",
      "description": "Return values / output schema for the capability.",
      "items": {
        "type": "object",
        "properties": {
          "name": { "type": "string" },
          "datatype": { "type": "string" },
          "description": { "type": "string" }
        },
        "required": ["name", "datatype"]
      }
    },

    "runtimeRequirements": {
      "type": "object",
      "description": "Runtime execution constraints needed for this capability.",
      "properties": {
        "sandboxProfile": { "type": "string" },
        "executionContext": { "type": "string" },
        "model": { "type": "string" },
        "externalDependencies": {
          "type": "array",
          "items": { "type": "string" }
        }
      }
    },

    "governance": {
      "type": "object",
      "description": "Semantic governance rules for this capability.",
      "properties": {
        "allowRoles": {
          "type": "array",
          "items": { "type": "string" }
        },
        "denyRoles": {
          "type": "array",
          "items": { "type": "string" }
        },
        "requiresDelegation": {
          "type": "boolean",
          "default": false
        },
        "auditLevel": {
          "type": "string",
          "enum": ["none", "basic", "strict", "cryptographic"],
          "default": "basic"
        }
      }
    }
  },

  "required": ["id", "type", "description"],

  "if": {
    "properties": { "type": { "const": "cap:CompositeCapability" } }
  },
  "then": {
    "properties": {
      "includes": {
        "type": "array",
        "description": "Capability elements that form part of this composite capability.",
        "items": { "type": "string" }
      }
    },
    "required": ["includes"]
  }
}
